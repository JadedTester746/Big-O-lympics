<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name = "viewport" content "width = device-width, initial-scale = 1">
        <title> Account </title>
        <link rel= "icon" type = "png" href = "OlympicsLogo.png">
        <link rel = "stylesheet" href = "css/style.css">
    </head>
    <body>
        <div class = "title">
            <div class = "row">
                <div class = "left-group" style = "display: flex; align-items: center;">
                    <div class = "titleBOX">
                        <img class = "logo" src = ImageFolder/Logo.png>
                    </div>
                    <div class = "titleBOX">
                        <a href = "index.html"> <span style = "font-size: 250%;color:rgb(10, 100, 160)"> <b>Big-(O)lympics</b> </span> </a>
                    </div>
                </div>
            </div>
        </div>
    
        <hr>
        <div class = "title">
            <div class = "row">
                <div class="profile" id="profileContainer" style="width: 500px; height: 500px;">
                    <img id="preview" src="/profile-pic" class="rounded" 
                        onerror="this.src='ImageFolder/default.jpg'" 
                        style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover;">

                    <h3 style="margin-top: 20px;">Upload Profile Picture</h3>
                    <form id="uploadForm" enctype="multipart/form-data">
                        <input type="file" name="file" accept="image/*" required>
                        <button type="submit">Upload</button>
                    </form>

                    <div class="name-change-box" style="margin-top: 20px;">
                        <label for="newName">Change display name:</label>
                        <input type="text" id="newName" placeholder="Enter new name">
                        <button onclick="changeName()">Submit</button>
                        <p id="nameChangeStatus" style="color: green;"></p>
                    </div>  
                    <br>
                    <b>Display Name: <span id="user"></span></b> <br>
                    <b>Tests Completed: <span id="completedPackets"></span></b> <br>
                    <b>Current Title: <span id = "titleText"></span></b> <br>
                </div>
            </div>
        </div>
    </body>
    <script>
        function changeName() {
            const newName = document.getElementById('newName').value.trim();
            if (!newName) {
                alert("Please enter a valid name.");
                return;
            }
    
            fetch(`/namechange?name=${encodeURIComponent(newName)}`, {
                method: "GET",
                credentials: "include"
            })
            .then(res => {
                if (res.ok) {
                    document.getElementById('nameChangeStatus').textContent = "Name updated successfully!";
                    document.getElementById('user').textContent = newName;
                } else {
                    document.getElementById('nameChangeStatus').style.color = "red";
                    document.getElementById('nameChangeStatus').textContent = "Failed to update name.";
                }
            })
            .catch(err => {
                document.getElementById('nameChangeStatus').style.color = "red";
                document.getElementById('nameChangeStatus').textContent = "Error contacting server.";
                console.error(err);
            });
        }
    </script>

    <script>
        document.getElementById("uploadForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const formData = new FormData(this);
    
            fetch("/uploadProfilePic", {
                method: "POST",
                body: formData,
                credentials: "include"
            }).then(res => {
                if (res.ok) {
                    alert("Upload successful!");
                    document.getElementById("preview").src = "/profile-pic?" + new Date().getTime(); // prevent caching
                } else {
                    alert("Upload failed.");
                }
            });
        });
    </script>
    
</html>